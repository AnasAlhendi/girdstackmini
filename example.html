<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>GridStack Minimal Example</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        font: 14px/1.2 system-ui, sans-serif;
      }

      .controls {
        margin: 10px auto;
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .grid-stack {
        width: 100%;
        margin: 20px auto;
      }
      .grid-stack-item-content {
        background: #4b8cfb;
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
      }
    </style>
  </head>
  <body>
    <div class="controls">
      <label for="screenSelect">Screen:</label>
      <select id="screenSelect"></select>
      <input id="screenValue" type="text" readonly placeholder="screen value" style="min-width:320px" />
      <button id="copyScreenValue">Copy</button>
      <button id="add">Add Widget</button>
      <button id="addHtmlWrap">Add HTML â†’ Button</button>
      <button id="addHtmlPre">Add Prebuilt</button>
      <button id="move">Move/Resize B</button>
      <button id="remove">Remove A</button>
    </div>
    <div class="grid-stack" id="grid"></div>

    <script src="gridstack.js"></script>
    <script>
      // DOM references
      const screenSelect = document.getElementById('screenSelect');
      const screenValue  = document.getElementById('screenValue');
      const gridEl       = document.getElementById('grid');

      // Grid instance
      let grid;

      // Profiles
      const profiles = [
        { title: '22" 1080 x 1920 (Portrait) Zelos v2', columns: 12, rows: 25, boxPadding: '29px', edgePadding: '29px', width: 1080, height: 1920 },
        { title: '15" 1080 x 1920 (Portrait) Zelos v1', columns: 12, rows: 22, boxPadding: '28px', edgePadding: '34px', width: 1080, height: 1920 },
        { title: '15" 1024 x 768 (Landscape) Mitra v1', columns: 12, rows: 10, boxPadding: '29px', edgePadding: '29px', width: 1024, height: 768 },
        { title: '19" 1280 x 1024 (Landscape) Mirta v2', columns: 12, rows: 13, boxPadding: '34px', edgePadding: '34px', width: 1280, height: 1024 },
      ];

      // Helpers
      function numberFromPx(v) {
        return parseInt(String(v || '').replace(/px$/i, ''), 10) || 0;
      }

      function profileNameFromTitle(title) {
        const match = (title || '').match(/zelos|mitra|mirta/i);
        const base = match ? match[0] : (title || 'Profile');
        return base.charAt(0).toUpperCase() + base.slice(1);
      }

      function formatProfileValue(p) {
        // e.g. "Zelos heig 12 width 22 boxpadding 29 edaging padding 29 screenwidth 1080 screenheight 1920"
        const name = profileNameFromTitle(p.title);
        return (
          name +
          ' heig ' + p.rows +
          ' width ' + p.columns +
          ' boxpadding ' + numberFromPx(p.boxPadding) +
          ' edaging padding ' + numberFromPx(p.edgePadding) +
          ' screenwidth ' + p.width +
          ' screenheight ' + p.height
        );
      }

      function populateScreenOptions() {
        screenSelect.innerHTML = '';
        profiles.forEach((p, i) => {
          const opt = document.createElement('option');
          opt.value = String(i); // use index as value
          opt.textContent = p.title;
          screenSelect.appendChild(opt);
        });
      }

      function initGrid(profile) {
        if (!profile) return;
        if (grid) grid.destroy();

        grid = new GridStack('#grid', {
          columns: profile.columns,
          rows: profile.rows,
          margin: profile.boxPadding,
          bottomBar: { columns: 4, rows: 1, cellHeight: 80, margin: 0, lineHeight: 8, color: '#000' }
        });

        // Container sizing
        gridEl.style.padding = '0';
        gridEl.style.width   = profile.width  ? profile.width  + 'px' : '';
        gridEl.style.height  = profile.height ? profile.height + 'px' : '';

        // Keep exact container height by adjusting cellHeight
        const gap  = numberFromPx(profile.boxPadding);
        const rows = profile.rows || 12;
        if (profile.height) {
          const cellH = (profile.height - Math.max(0, rows - 1) * gap) / rows;
          if (cellH > 0) grid.setCellHeight(cellH);
        }
      }

      function onProfileChange() {
        const idx = Number(screenSelect.value);
        const p = profiles[idx];
        if (!p) return;
        screenValue.value = formatProfileValue(p);
        initGrid(p);
      }

      function copyScreenValue() {
        const value = screenValue.value || '';
        navigator.clipboard.writeText(value).catch(() => {
          screenValue.select();
          if (document.execCommand) document.execCommand('copy');
        });
      }

      // Setup
      populateScreenOptions();
      screenSelect.value = '0';
      screenValue.value = formatProfileValue(profiles[0]);
      initGrid(profiles[0]);

      // Initial widgets A and B
      const widgetA = grid.addWidget({ x: 0, y: 0, w: 2, h: 2, content: 'A' });
      const widgetB = grid.addWidget({ x: 1, y: 0, w: 2, h: 2, content: 'B' });
      widgetB.id = 'item-b';

      // Bottom bar: add 4 widgets (1x1 each across the single row)
      const bottomEls = [];
      if (grid.addBottomWidget) {
        bottomEls.push(grid.addBottomWidget({ x: 0, y: 0, w: 1, h: 1, content: 'B1' }));
        bottomEls.push(grid.addBottomWidget({ x: 1, y: 0, w: 1, h: 1, content: 'B2' }));
        bottomEls.push(grid.addBottomWidget({ x: 2, y: 0, w: 1, h: 1, content: 'B3' }));
        bottomEls.push(grid.addBottomWidget({ x: 3, y: 0, w: 1, h: 1, content: 'B4' }));
      }

      // Events
      screenSelect.addEventListener('change', onProfileChange);
      document.getElementById('copyScreenValue').addEventListener('click', copyScreenValue);

      document.getElementById('add').addEventListener('click', () => {
        const count = document.querySelectorAll('.grid-stack-item').length;
        grid.addWidget({ w: 2, h: 2, content: 'New ' + count });
      });

      document.getElementById('addHtmlWrap').addEventListener('click', () => {
        const html = '<button style="background:#444;color:#fff;border:0;border-radius:8px">B</button>';
        grid.addWidgetHTML(html, { x: 0, y: 0, w: 1, h: 1 });
      });

      document.getElementById('addHtmlPre').addEventListener('click', () => {
        const prebuilt = '<button class="grid-stack-item" gs-x="0" gs-y="2" gs-w="3" gs-h="2" style="background:#2c6bf2;color:#fff;border:0;border-radius:8px;outline:3px solid #000;font-weight:700">PREBUILT</button>';
        grid.addWidgetHTML(prebuilt);
      });

      document.getElementById('move').addEventListener('click', () => {
        grid.updateWidget('#item-b', { x: 6, y: 1, w: 5, h: 2 });
        if (grid.updateBottomWidget && bottomEls[0]) {
          grid.updateBottomWidget(bottomEls[0], { x: 2, y: 0, w: 2, h: 1 });
        }
      });

      document.getElementById('remove').addEventListener('click', () => {
        grid.removeWidget(widgetA);
      });
    </script>
  </body>
  </html>
